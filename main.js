!function(){"use strict";class e{constructor(e,t,s,r,i){this._name=e.name,this._link=e.link,this._isLiked=e.isLiked,this._id=e._id,this._cardSelector=t,this._handleImageClick=s,this._handleDelete=r,this._handleLike=i}_setEventListener(){this._cardLikeBtn=this._cardElement.querySelector(".card__group"),this._cardTrashBtn=this._cardElement.querySelector(".card__trash-bin"),this._cardImage=this._cardElement.querySelector(".card__image"),this._cardLikeBtn.addEventListener("click",(()=>{this._handleLike({isLiked:this._isLiked,id:this._id},this)})),this._cardTrashBtn.addEventListener("click",(()=>{this._handleDelete(this)})),this._cardImage.addEventListener("click",(()=>{this._handleImageClick(this)}))}_renderLikes(){this._isLiked?this._cardLikeBtn.classList.add("card__group_active"):this._cardLikeBtn.classList.remove("card__group_active")}setLike(e){this._isLiked=e,this._renderLikes()}handleTrashBtn(e){this._delete=e,this._cardElement.remove(),this._cardElement=null}_getTemplate(){return this._cardElement=document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0),this._cardElement}generateCard(){return this._element=this._getTemplate(),this._setEventListener(),this._renderLikes(),this._cardTitle=this._element.querySelector(".card__title"),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._cardTitle.textContent=this._name,this._element}}class t{constructor(e,t){this._options=e,this._formElement=t,this._buttonElement=this._formElement.querySelector(this._options.submitButtonSelector),this._inputList=[...this._formElement.querySelectorAll(this._options.inputSelector)]}_showInputError(){this._errorElement=document.querySelector(`.${this._inputElement.id}-error`),this._errorElement.textContent=this._inputElement.validationMessage,this._errorElement.classList.add(this._options.errorClass),this._inputElement.classList.add(this._options.inputClassError)}_hideInputError(){this._errorElement=this._formElement.querySelector(`.${this._inputElement.id}-error`),this._errorElement.textContent="",this._errorElement.classList.remove(this._options.errorClass),this._inputElement.classList.remove(this._options.inputClassError)}resetValidation(){this.toggleButtonState(),this._inputList.forEach((e=>{this._inputElement=e,this._hideInputError()}))}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}toggleButtonState(){this._hasInvalidInput()?this._buttonElement.setAttribute("disabled",!0):this._buttonElement.removeAttribute("disabled")}_checkInputValidity(){this._inputElement.validity.valid?this._hideInputError():this._showInputError()}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._inputElement=e,this._checkInputValidity(),this.toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class s{constructor(e,t){let{data:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=t}renderItems(){this._items.reverse().forEach(this._renderer)}addItem(e){this._container.prepend(e)}}class r{constructor(e){let{popupSelector:t}=e;this._popupElement=document.querySelector(t),this._closeBtn=this._popupElement.querySelector(".modal__close-btn")}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose=e=>{"Escape"===e.key&&this.close()};setEventListener(){this._closeBtn.addEventListener("click",(()=>{this.close()})),this._popupElement.addEventListener("mousedown",(e=>{e.target===this._popupElement&&this.close()}))}}class i extends r{constructor(e,t){super({popupSelector:e}),this._popupForm=this._popupElement.querySelector(".modal__form"),this._handleFormSubmit=t,this._inputList=[...this._popupForm.querySelectorAll(".modal__input")],this._modalBtn=this._popupElement.querySelector(".modal__btn"),this._modalBtnText=this._modalBtn.textContent}close(){super.close(),this._popupForm.reset()}_getValueInputs(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}setInputValues(e){this._inputList.forEach((t=>{t.value=e[t.name]}))}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._modalBtn.textContent=e?t:this._modalBtnText}setEventListener(){this._popupForm.addEventListener("submit",(()=>{this._handleFormSubmit(this._getValueInputs())})),super.setEventListener()}}const n=document.querySelector(".page"),o=(n.querySelector(".profile-modal"),n.querySelector(".cards__list")),a=n.querySelector(".profile__edit-btn"),l=n.querySelector(".profile__create-btn"),d=n.querySelector(".profile__edit-avatar"),h=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}getInitialCards(){return this._request(`${this._baseUrl}/cards`,{headers:this._headers})}addNewCard(e){let{name:t,link:s}=e;return this._request(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})})}deleteCard(e){let{_id:t}=e;return this._request(`${this._baseUrl}/cards/${t}`,{method:"DELETE",headers:this._headers})}likeCard(e){let{isLiked:t,id:s}=e;return this._request(`${this._baseUrl}/cards/${s}/likes`,{method:t?"DELETE":"PUT",headers:this._headers})}getUserInfo(){return this._request(`${this._baseUrl}/users/me`,{headers:this._headers})}editUserInfo(e){let{name:t,occupation:s}=e;return this._request(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})})}editUserImage(e){return this._request(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}_request(e,t){return fetch(e,t).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"3c5909bd-d1c1-439d-8361-757b3ef3e3b4","content-type":"application/json"}}),c={};var _;_={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__btn",errorClass:"modal__input-error_active",inputClassError:"modal__input_type_error"},[...document.querySelectorAll(_.formSelector)].forEach((e=>{const s=new t(_,e),r=e.getAttribute("name");c[r]=s,s.enableValidation()}));const u=e=>{L.open(e)},m=e=>{b.open(),b.setSubmitAction((()=>{h.deleteCard(e).then((()=>{b.close(),e.handleTrashBtn()})).catch(console.error)}))},p=(e,t)=>{h.likeCard(e).then((e=>{t.setLike(e.isLiked)})).catch(console.error)},E=t=>new e(t,"#card__template",u,m,p).generateCard(),L=new class extends r{constructor(e){super({popupSelector:e}),this._pictureImage=document.querySelector(".picture-modal__image"),this._pictureTitle=document.querySelector(".picture-modal__title")}open(e){let{_name:t,_link:s}=e;this._pictureImage.src=s,this._pictureImage.alt=t,this._pictureTitle.textContent=t,super.open()}}(".picture-modal");L.setEventListener();const v=new i(".add-card-modal",(e=>{v.renderLoading(!0),h.addNewCard(e).then((e=>{const t=E(e);y.addItem(t),v.close()})).catch(console.error).finally((()=>{v.renderLoading(!1)}))}));v.setEventListener();const g=new class{constructor(e,t,s){this._name=document.querySelector(e),this._occupation=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._name.textContent,occupation:this._occupation.textContent}}setUserInfo(e){let{name:t,about:s}=e;this._name.textContent=t,this._occupation.textContent=s}changeUserPhoto(e){this._avatar.src=e}}(".profile__name",".profile__occupation",".profile__avatar"),S=new i(".profile-modal",(e=>{S.renderLoading(!0),h.editUserInfo(e).then((e=>{g.setUserInfo(e),S.close()})).catch(console.error).finally((()=>{S.renderLoading(!1)}))}));S.setEventListener();const f=new i(".change-profile-modal",(e=>{let{url:t}=e;f.renderLoading(!0),h.editUserImage(t).then((e=>{g.changeUserPhoto(e.avatar),f.close()})).catch(console.error).finally((()=>{f.renderLoading(!1)}))}));f.setEventListener();const b=new class extends r{constructor(e){super({popupSelector:e}),this._button=this._popupElement.querySelector(".modal__btn")}setSubmitAction(e){this._handleSubmit=e}setEventListener(){super.setEventListener(),this._button.addEventListener("click",(()=>{this._handleSubmit()}))}}(".delete-confirmation-modal");let y;b.setEventListener(),a.addEventListener("click",(()=>{c["profile-form"].resetValidation(),S.open(),S.setInputValues(g.getUserInfo())})),l.addEventListener("click",(()=>{c["card-form"].resetValidation(),v.open()})),d.addEventListener("click",(()=>{c["change-profile-form"].resetValidation(),f.open()})),Promise.all([h.getInitialCards(),h.getUserInfo()]).then((e=>{let[t,r]=e;g.setUserInfo(r),g.changeUserPhoto(r.avatar),y=new s({data:t,renderer:e=>{const t=E(e);y.addItem(t)}},o),y.renderItems()})).catch(console.error)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUluRyxFQUNoQixDQUNFM0UsS0FBTThMLEVBQ05oSCxTQUFXOUUsSUFDVCxNQUFNNkssRUFBY0osRUFBV3pLLEdBQy9COEssRUFBWTFGLFFBQVF5RixFQUFZLEdBR3BDMUQsR0FFRjJELEVBQVk1RixhQUFhLElBRTFCa0YsTUFBTUMsUUFBUUMsTSIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xyXG4gIGNvbnN0cnVjdG9yKGRhdGEsIGNhcmRTZWxlY3RvciwgaGFuZGxlSW1hZ2VDbGljaywgaGFuZGxlRGVsZXRlLCBoYW5kbGVMaWtlKSB7XHJcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lO1xyXG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcclxuICAgIHRoaXMuX2lzTGlrZWQgPSBkYXRhLmlzTGlrZWQ7XHJcbiAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xyXG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xyXG4gICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayA9IGhhbmRsZUltYWdlQ2xpY2s7XHJcbiAgICB0aGlzLl9oYW5kbGVEZWxldGUgPSBoYW5kbGVEZWxldGU7XHJcbiAgICB0aGlzLl9oYW5kbGVMaWtlID0gaGFuZGxlTGlrZTtcclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVyKCkge1xyXG4gICAgdGhpcy5fY2FyZExpa2VCdG4gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2dyb3VwXCIpO1xyXG4gICAgdGhpcy5fY2FyZFRyYXNoQnRuID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190cmFzaC1iaW5cIik7XHJcbiAgICB0aGlzLl9jYXJkSW1hZ2UgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xyXG5cclxuICAgIHRoaXMuX2NhcmRMaWtlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuX2hhbmRsZUxpa2UoeyBpc0xpa2VkOiB0aGlzLl9pc0xpa2VkLCBpZDogdGhpcy5faWQgfSwgdGhpcyk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX2NhcmRUcmFzaEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICB0aGlzLl9oYW5kbGVEZWxldGUodGhpcyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9jYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayh0aGlzKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX3JlbmRlckxpa2VzKCkge1xyXG4gICAgaWYgKHRoaXMuX2lzTGlrZWQpIHtcclxuICAgICAgdGhpcy5fY2FyZExpa2VCdG4uY2xhc3NMaXN0LmFkZChcImNhcmRfX2dyb3VwX2FjdGl2ZVwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2NhcmRMaWtlQnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19ncm91cF9hY3RpdmVcIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRMaWtlKHZhbHVlKSB7XHJcbiAgICB0aGlzLl9pc0xpa2VkID0gdmFsdWU7XHJcbiAgICB0aGlzLl9yZW5kZXJMaWtlcygpO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlVHJhc2hCdG4odmFsdWUpIHtcclxuICAgIHRoaXMuX2RlbGV0ZSA9IHZhbHVlO1xyXG4gICAgdGhpcy5fY2FyZEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcclxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICByZXR1cm4gdGhpcy5fY2FyZEVsZW1lbnQ7XHJcbiAgfVxyXG5cclxuICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXIoKTtcclxuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XHJcbiAgICB0aGlzLl9jYXJkVGl0bGUgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XHJcbiAgICB0aGlzLl9jYXJkSW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcclxuICAgIHRoaXMuX2NhcmRJbWFnZS5hbHQgPSB0aGlzLl9uYW1lO1xyXG4gICAgdGhpcy5fY2FyZFRpdGxlLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgZm9ybVZhbGlkYXRvciB7XHJcbiAgY29uc3RydWN0b3Iob3B0aW9ucywgZm9ybUVsZW1lbnQpIHtcclxuICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcclxuICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICB0aGlzLl9vcHRpb25zLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgICApO1xyXG4gICAgdGhpcy5faW5wdXRMaXN0ID0gW1xyXG4gICAgICAuLi50aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX29wdGlvbnMuaW5wdXRTZWxlY3RvciksXHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgX3Nob3dJbnB1dEVycm9yKCkge1xyXG4gICAgdGhpcy5fZXJyb3JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgYC4ke3RoaXMuX2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG4gICAgdGhpcy5fZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gdGhpcy5faW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlO1xyXG4gICAgdGhpcy5fZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fb3B0aW9ucy5lcnJvckNsYXNzKTtcclxuICAgIHRoaXMuX2lucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX29wdGlvbnMuaW5wdXRDbGFzc0Vycm9yKTtcclxuICB9XHJcblxyXG4gIF9oaWRlSW5wdXRFcnJvcigpIHtcclxuICAgIHRoaXMuX2Vycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIGAuJHt0aGlzLl9pbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuICAgIHRoaXMuX2Vycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgICB0aGlzLl9lcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9vcHRpb25zLmVycm9yQ2xhc3MpO1xyXG4gICAgdGhpcy5faW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fb3B0aW9ucy5pbnB1dENsYXNzRXJyb3IpO1xyXG4gIH1cclxuXHJcbiAgcmVzZXRWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy50b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICB0aGlzLl9pbnB1dEVsZW1lbnQgPSBpbnB1dEVsZW1lbnQ7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5faW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XHJcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KCkpIHtcclxuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KCkge1xyXG4gICAgaWYgKCF0aGlzLl9pbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2lucHV0RWxlbWVudCA9IGlucHV0RWxlbWVudDtcclxuICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoKTtcclxuICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xyXG4gIGNvbnN0cnVjdG9yKHsgZGF0YSwgcmVuZGVyZXIgfSwgY29udGFpbmVyKSB7XHJcbiAgICB0aGlzLl9pdGVtcyA9IGRhdGE7XHJcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgdGhpcy5fY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVySXRlbXMoKSB7XHJcbiAgICB0aGlzLl9pdGVtcy5yZXZlcnNlKCkuZm9yRWFjaCh0aGlzLl9yZW5kZXJlcik7XHJcbiAgfVxyXG5cclxuICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IoeyBwb3B1cFNlbGVjdG9yIH0pIHtcclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9jbG9zZUJ0biA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XHJcbiAgfVxyXG5cclxuICBvcGVuKCkge1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpIHtcclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZUVzY0Nsb3NlID0gKGUpID0+IHtcclxuICAgIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcigpIHtcclxuICAgIHRoaXMuX2Nsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcclxuICAgICAgaWYgKGUudGFyZ2V0ID09PSB0aGlzLl9wb3B1cEVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCkge1xyXG4gICAgc3VwZXIoeyBwb3B1cFNlbGVjdG9yIH0pO1xyXG4gICAgdGhpcy5fcG9wdXBGb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XHJcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcclxuICAgIHRoaXMuX2lucHV0TGlzdCA9IFsuLi50aGlzLl9wb3B1cEZvcm0ucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9faW5wdXRcIildO1xyXG4gICAgdGhpcy5fbW9kYWxCdG4gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnRuXCIpO1xyXG4gICAgdGhpcy5fbW9kYWxCdG5UZXh0ID0gdGhpcy5fbW9kYWxCdG4udGV4dENvbnRlbnQ7XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpIHtcclxuICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICB0aGlzLl9wb3B1cEZvcm0ucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIF9nZXRWYWx1ZUlucHV0cygpIHtcclxuICAgIGNvbnN0IGRhdGEgPSB7fTtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgZGF0YVtpbnB1dEVsZW1lbnQubmFtZV0gPSBpbnB1dEVsZW1lbnQudmFsdWU7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH1cclxuXHJcbiAgc2V0SW5wdXRWYWx1ZXMoZGF0YSkge1xyXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICBpbnB1dEVsZW1lbnQudmFsdWUgPSBkYXRhW2lucHV0RWxlbWVudC5uYW1lXTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcsIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIikge1xyXG4gICAgaWYgKGlzTG9hZGluZykge1xyXG4gICAgICB0aGlzLl9tb2RhbEJ0bi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fbW9kYWxCdG4udGV4dENvbnRlbnQgPSB0aGlzLl9tb2RhbEJ0blRleHQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVyKCkge1xyXG4gICAgdGhpcy5fcG9wdXBGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKCkgPT4ge1xyXG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldFZhbHVlSW5wdXRzKCkpO1xyXG4gICAgfSk7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVyKCk7XHJcbiAgfVxyXG59XHJcbiIsIi8vID09PT09PT0gRUxFTUVOVFMgPT09PT09PVxyXG5cclxuLy8gV1JBUFBFUlxyXG5leHBvcnQgY29uc3QgcGFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGFnZVwiKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVNb2RhbCA9IHBhZ2UucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlLW1vZGFsXCIpO1xyXG5cclxuLy8gQ0FSRFNcclxuZXhwb3J0IGNvbnN0IGNhcmRzTGlzdCA9IHBhZ2UucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcclxuXHJcbi8vIEJUTlMgLyBOT0RFU1xyXG5leHBvcnQgY29uc3QgcHJvZmlsZUVkaXRCdG4gPSBwYWdlLnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idG5cIik7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlQ3JlYXRlQnRuID0gcGFnZS5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2NyZWF0ZS1idG5cIik7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlSW1hZ2VFZGl0ID0gcGFnZS5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYXZhdGFyXCIpO1xyXG5cclxuLy8gU0VUVElOR1NcclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXHJcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19idG5cIixcclxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dC1lcnJvcl9hY3RpdmVcIixcclxuICBpbnB1dENsYXNzRXJyb3I6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcclxufTtcclxuIiwiLyogX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fICogXHJcblxyXG4qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSU1QT1JUUyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4qICBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18gKi9cclxuXHJcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcclxuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhDb25maXJtYXRpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xyXG5cclxuaW1wb3J0IHtcclxuICBjYXJkc0xpc3QsXHJcbiAgcHJvZmlsZUVkaXRCdG4sXHJcbiAgcHJvZmlsZUNyZWF0ZUJ0bixcclxuICBjb25maWcsXHJcbiAgcHJvZmlsZUltYWdlRWRpdCxcclxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcblxyXG4vKiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18gKiBcclxuXHJcbiogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDTEFTUyBJTlNUQU5DRVMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuXHJcbiogIF9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXyAqL1xyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiM2M1OTA5YmQtZDFjMS00MzlkLTgzNjEtNzU3YjNlZjNlM2I0XCIsXHJcbiAgICBcImNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICB9LFxyXG59KTtcclxuXHJcbmNvbnN0IGZvcm1WYWxpZGF0b3JzID0ge307XHJcblxyXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGZvcm1MaXN0ID0gWy4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3RvcildO1xyXG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XHJcbiAgICBjb25zdCB2YWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25maWcsIGZvcm1FbGVtZW50KTtcclxuICAgIGNvbnN0IGZvcm1OYW1lID0gZm9ybUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwibmFtZVwiKTtcclxuICAgIGZvcm1WYWxpZGF0b3JzW2Zvcm1OYW1lXSA9IHZhbGlkYXRvcjtcclxuICAgIHZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbiAgfSk7XHJcbn07XHJcbmVuYWJsZVZhbGlkYXRpb24oY29uZmlnKTtcclxuXHJcbmNvbnN0IGhhbmRsZUltYWdlQ2xpY2sgPSAoZGF0YSkgPT4ge1xyXG4gIGltYWdlUG9wdXAub3BlbihkYXRhKTtcclxufTtcclxuXHJcbmNvbnN0IGhhbmRsZURlbGV0ZSA9IChjYXJkKSA9PiB7XHJcbiAgY29uZmlybWF0aW9uUG9wdXAub3BlbigpO1xyXG4gIGNvbmZpcm1hdGlvblBvcHVwLnNldFN1Ym1pdEFjdGlvbigoKSA9PiB7XHJcbiAgICBhcGlcclxuICAgICAgLmRlbGV0ZUNhcmQoY2FyZClcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGNvbmZpcm1hdGlvblBvcHVwLmNsb3NlKCk7XHJcbiAgICAgICAgY2FyZC5oYW5kbGVUcmFzaEJ0bigpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5jb25zdCBoYW5kbGVMaWtlID0gKGRhdGEsIHNwZWNpZmljQ2FyZCkgPT4ge1xyXG4gIGFwaVxyXG4gICAgLmxpa2VDYXJkKGRhdGEpXHJcbiAgICAudGhlbigocmVzdWx0cykgPT4ge1xyXG4gICAgICBzcGVjaWZpY0NhcmQuc2V0TGlrZShyZXN1bHRzLmlzTGlrZWQpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcclxufTtcclxuXHJcbmNvbnN0IGNyZWF0ZUNhcmQgPSAoZGF0YSkgPT4ge1xyXG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcclxuICAgIGRhdGEsXHJcbiAgICBcIiNjYXJkX190ZW1wbGF0ZVwiLFxyXG4gICAgaGFuZGxlSW1hZ2VDbGljayxcclxuICAgIGhhbmRsZURlbGV0ZSxcclxuICAgIGhhbmRsZUxpa2VcclxuICApO1xyXG4gIHJldHVybiBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xyXG59O1xyXG5cclxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIi5waWN0dXJlLW1vZGFsXCIpO1xyXG5pbWFnZVBvcHVwLnNldEV2ZW50TGlzdGVuZXIoKTtcclxuXHJcbmNvbnN0IG5ld0NhcmRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLmFkZC1jYXJkLW1vZGFsXCIsIChkYXRhKSA9PiB7XHJcbiAgbmV3Q2FyZFBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSk7XHJcbiAgYXBpXHJcbiAgICAuYWRkTmV3Q2FyZChkYXRhKVxyXG4gICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcclxuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjcmVhdGVDYXJkKHJlc3VsdHMpO1xyXG4gICAgICBjYXJkU2VjdGlvbi5hZGRJdGVtKGNhcmRFbGVtZW50KTtcclxuICAgICAgbmV3Q2FyZFBvcHVwLmNsb3NlKCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIG5ld0NhcmRQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcclxuICAgIH0pO1xyXG59KTtcclxubmV3Q2FyZFBvcHVwLnNldEV2ZW50TGlzdGVuZXIoKTtcclxuXHJcbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKFxyXG4gIFwiLnByb2ZpbGVfX25hbWVcIixcclxuICBcIi5wcm9maWxlX19vY2N1cGF0aW9uXCIsXHJcbiAgXCIucHJvZmlsZV9fYXZhdGFyXCJcclxuKTtcclxuXHJcbmNvbnN0IHByb2ZpbGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnByb2ZpbGUtbW9kYWxcIiwgKGRhdGEpID0+IHtcclxuICBwcm9maWxlUG9wdXAucmVuZGVyTG9hZGluZyh0cnVlKTtcclxuICBhcGlcclxuICAgIC5lZGl0VXNlckluZm8oZGF0YSlcclxuICAgIC50aGVuKChyZXN1bHRzKSA9PiB7XHJcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHJlc3VsdHMpO1xyXG4gICAgICBwcm9maWxlUG9wdXAuY2xvc2UoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgcHJvZmlsZVBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5wcm9maWxlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcigpO1xyXG5cclxuY29uc3QgY2hhbmdlUHJvZmlsZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgXCIuY2hhbmdlLXByb2ZpbGUtbW9kYWxcIixcclxuICAoeyB1cmwgfSkgPT4ge1xyXG4gICAgY2hhbmdlUHJvZmlsZVBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSk7XHJcbiAgICBhcGlcclxuICAgICAgLmVkaXRVc2VySW1hZ2UodXJsKVxyXG4gICAgICAudGhlbigocmVzdWx0cykgPT4ge1xyXG4gICAgICAgIHVzZXJJbmZvLmNoYW5nZVVzZXJQaG90byhyZXN1bHRzLmF2YXRhcik7XHJcbiAgICAgICAgY2hhbmdlUHJvZmlsZVBvcHVwLmNsb3NlKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxyXG4gICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgY2hhbmdlUHJvZmlsZVBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xyXG4gICAgICB9KTtcclxuICB9XHJcbik7XHJcbmNoYW5nZVByb2ZpbGVQb3B1cC5zZXRFdmVudExpc3RlbmVyKCk7XHJcblxyXG5jb25zdCBjb25maXJtYXRpb25Qb3B1cCA9IG5ldyBQb3B1cFdpdGhDb25maXJtYXRpb24oXHJcbiAgXCIuZGVsZXRlLWNvbmZpcm1hdGlvbi1tb2RhbFwiXHJcbik7XHJcbmNvbmZpcm1hdGlvblBvcHVwLnNldEV2ZW50TGlzdGVuZXIoKTtcclxuXHJcbi8qIF9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXyAqIFxyXG4gIFxyXG4gICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVWRU5UIExJU1RFTkVSUyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICBcclxuICAqICBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18gKi9cclxuXHJcbnByb2ZpbGVFZGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgZm9ybVZhbGlkYXRvcnNbXCJwcm9maWxlLWZvcm1cIl0ucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgcHJvZmlsZVBvcHVwLm9wZW4oKTtcclxuICBwcm9maWxlUG9wdXAuc2V0SW5wdXRWYWx1ZXModXNlckluZm8uZ2V0VXNlckluZm8oKSk7XHJcbn0pO1xyXG5cclxucHJvZmlsZUNyZWF0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGZvcm1WYWxpZGF0b3JzW1wiY2FyZC1mb3JtXCJdLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIG5ld0NhcmRQb3B1cC5vcGVuKCk7XHJcbn0pO1xyXG5cclxucHJvZmlsZUltYWdlRWRpdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGZvcm1WYWxpZGF0b3JzW1wiY2hhbmdlLXByb2ZpbGUtZm9ybVwiXS5yZXNldFZhbGlkYXRpb24oKTtcclxuICBjaGFuZ2VQcm9maWxlUG9wdXAub3BlbigpO1xyXG59KTtcclxuXHJcbmxldCBjYXJkU2VjdGlvbjtcclxuXHJcblByb21pc2UuYWxsKFthcGkuZ2V0SW5pdGlhbENhcmRzKCksIGFwaS5nZXRVc2VySW5mbygpXSlcclxuICAudGhlbigoW2NhcmRzLCB1c2VyRGF0YV0pID0+IHtcclxuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXJEYXRhKTtcclxuICAgIHVzZXJJbmZvLmNoYW5nZVVzZXJQaG90byh1c2VyRGF0YS5hdmF0YXIpO1xyXG4gICAgY2FyZFNlY3Rpb24gPSBuZXcgU2VjdGlvbihcclxuICAgICAge1xyXG4gICAgICAgIGRhdGE6IGNhcmRzLFxyXG4gICAgICAgIHJlbmRlcmVyOiAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjcmVhdGVDYXJkKGRhdGEpO1xyXG4gICAgICAgICAgY2FyZFNlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgfSxcclxuICAgICAgY2FyZHNMaXN0XHJcbiAgICApO1xyXG4gICAgY2FyZFNlY3Rpb24ucmVuZGVySXRlbXMoKTtcclxuICB9KVxyXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcclxuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xyXG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XHJcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcclxuICB9XHJcblxyXG4gIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhZGROZXdDYXJkKHsgbmFtZSwgbGluayB9KSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgbGluayxcclxuICAgICAgfSksXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZUNhcmQoeyBfaWQgfSkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtfaWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGxpa2VDYXJkKHsgaXNMaWtlZCwgaWQgfSkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH0vbGlrZXNgLCB7XHJcbiAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBvY2N1cGF0aW9uIH0pIHtcclxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgYWJvdXQ6IG9jY3VwYXRpb24sXHJcbiAgICAgIH0pLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlZGl0VXNlckltYWdlKHVybCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcjogdXJsLFxyXG4gICAgICB9KSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX3JlcXVlc3QodXJsLCBvcHRpb25zKSB7XHJcbiAgICByZXR1cm4gZmV0Y2godXJsLCBvcHRpb25zKS50aGVuKChyZXMpID0+XHJcbiAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XHJcbiAgICBzdXBlcih7IHBvcHVwU2VsZWN0b3IgfSk7XHJcbiAgICB0aGlzLl9waWN0dXJlSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBpY3R1cmUtbW9kYWxfX2ltYWdlXCIpO1xyXG4gICAgdGhpcy5fcGljdHVyZVRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5waWN0dXJlLW1vZGFsX190aXRsZVwiKTtcclxuICB9XHJcblxyXG4gIG9wZW4oeyBfbmFtZSwgX2xpbmsgfSkge1xyXG4gICAgdGhpcy5fcGljdHVyZUltYWdlLnNyYyA9IF9saW5rO1xyXG4gICAgdGhpcy5fcGljdHVyZUltYWdlLmFsdCA9IF9uYW1lO1xyXG4gICAgdGhpcy5fcGljdHVyZVRpdGxlLnRleHRDb250ZW50ID0gX25hbWU7XHJcbiAgICBzdXBlci5vcGVuKCk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3RvcihuYW1lU2VsZWN0b3IsIG9jY3VwYXRpb25TZWxlY3RvciwgYXZhdGFyU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX25hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9vY2N1cGF0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvY2N1cGF0aW9uU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fYXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXJTZWxlY3Rvcik7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMuX25hbWUudGV4dENvbnRlbnQsXHJcbiAgICAgIG9jY3VwYXRpb246IHRoaXMuX29jY3VwYXRpb24udGV4dENvbnRlbnQsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XHJcbiAgICB0aGlzLl9uYW1lLnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgIHRoaXMuX29jY3VwYXRpb24udGV4dENvbnRlbnQgPSBhYm91dDtcclxuICB9XHJcblxyXG4gIGNoYW5nZVVzZXJQaG90byhhdmF0YXIpIHtcclxuICAgIHRoaXMuX2F2YXRhci5zcmMgPSBhdmF0YXI7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoQ29uZmlybWF0aW9uIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHsgcG9wdXBTZWxlY3RvciB9KTtcclxuICAgIHRoaXMuX2J1dHRvbiA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idG5cIik7XHJcbiAgfVxyXG5cclxuICBzZXRTdWJtaXRBY3Rpb24oZm4pIHtcclxuICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCA9IGZuO1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcigpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXIoKTtcclxuICAgIHRoaXMuX2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICB0aGlzLl9oYW5kbGVTdWJtaXQoKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVEZWxldGUiLCJoYW5kbGVMaWtlIiwidGhpcyIsIl9uYW1lIiwibmFtZSIsIl9saW5rIiwibGluayIsIl9pc0xpa2VkIiwiaXNMaWtlZCIsIl9pZCIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlSW1hZ2VDbGljayIsIl9oYW5kbGVEZWxldGUiLCJfaGFuZGxlTGlrZSIsIl9zZXRFdmVudExpc3RlbmVyIiwiX2NhcmRMaWtlQnRuIiwiX2NhcmRFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsIl9jYXJkVHJhc2hCdG4iLCJfY2FyZEltYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImlkIiwiX3JlbmRlckxpa2VzIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwic2V0TGlrZSIsInZhbHVlIiwiaGFuZGxlVHJhc2hCdG4iLCJfZGVsZXRlIiwiX2dldFRlbXBsYXRlIiwiZG9jdW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiZ2VuZXJhdGVDYXJkIiwiX2VsZW1lbnQiLCJfY2FyZFRpdGxlIiwic3JjIiwiYWx0IiwidGV4dENvbnRlbnQiLCJmb3JtVmFsaWRhdG9yIiwib3B0aW9ucyIsImZvcm1FbGVtZW50IiwiX29wdGlvbnMiLCJfZm9ybUVsZW1lbnQiLCJfYnV0dG9uRWxlbWVudCIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2lucHV0TGlzdCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwiX3Nob3dJbnB1dEVycm9yIiwiX2Vycm9yRWxlbWVudCIsIl9pbnB1dEVsZW1lbnQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImVycm9yQ2xhc3MiLCJpbnB1dENsYXNzRXJyb3IiLCJfaGlkZUlucHV0RXJyb3IiLCJyZXNldFZhbGlkYXRpb24iLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImZvckVhY2giLCJpbnB1dEVsZW1lbnQiLCJfaGFzSW52YWxpZElucHV0Iiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJzZXRBdHRyaWJ1dGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiZW5hYmxlVmFsaWRhdGlvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsIlNlY3Rpb24iLCJfcmVmIiwiY29udGFpbmVyIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJyZXZlcnNlIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwRWxlbWVudCIsIl9jbG9zZUJ0biIsIm9wZW4iLCJfaGFuZGxlRXNjQ2xvc2UiLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJrZXkiLCJzZXRFdmVudExpc3RlbmVyIiwidGFyZ2V0IiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsIl9wb3B1cEZvcm0iLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9tb2RhbEJ0biIsIl9tb2RhbEJ0blRleHQiLCJyZXNldCIsIl9nZXRWYWx1ZUlucHV0cyIsInNldElucHV0VmFsdWVzIiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsImxvYWRpbmdUZXh0IiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwicGFnZSIsImNhcmRzTGlzdCIsInByb2ZpbGVFZGl0QnRuIiwicHJvZmlsZUNyZWF0ZUJ0biIsInByb2ZpbGVJbWFnZUVkaXQiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJnZXRJbml0aWFsQ2FyZHMiLCJfcmVxdWVzdCIsImFkZE5ld0NhcmQiLCJfcmVmMiIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZGVsZXRlQ2FyZCIsIl9yZWYzIiwibGlrZUNhcmQiLCJfcmVmNCIsImdldFVzZXJJbmZvIiwiZWRpdFVzZXJJbmZvIiwiX3JlZjUiLCJvY2N1cGF0aW9uIiwiYWJvdXQiLCJlZGl0VXNlckltYWdlIiwidXJsIiwiYXZhdGFyIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImF1dGhvcml6YXRpb24iLCJmb3JtVmFsaWRhdG9ycyIsImNvbmZpZyIsImZvcm1TZWxlY3RvciIsInZhbGlkYXRvciIsIkZvcm1WYWxpZGF0b3IiLCJmb3JtTmFtZSIsImdldEF0dHJpYnV0ZSIsImltYWdlUG9wdXAiLCJjYXJkIiwiY29uZmlybWF0aW9uUG9wdXAiLCJzZXRTdWJtaXRBY3Rpb24iLCJjYXRjaCIsImNvbnNvbGUiLCJlcnJvciIsInNwZWNpZmljQ2FyZCIsInJlc3VsdHMiLCJjcmVhdGVDYXJkIiwiX3BpY3R1cmVJbWFnZSIsIl9waWN0dXJlVGl0bGUiLCJuZXdDYXJkUG9wdXAiLCJjYXJkRWxlbWVudCIsImNhcmRTZWN0aW9uIiwiZmluYWxseSIsInVzZXJJbmZvIiwibmFtZVNlbGVjdG9yIiwib2NjdXBhdGlvblNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJfb2NjdXBhdGlvbiIsIl9hdmF0YXIiLCJzZXRVc2VySW5mbyIsImNoYW5nZVVzZXJQaG90byIsInByb2ZpbGVQb3B1cCIsImNoYW5nZVByb2ZpbGVQb3B1cCIsIl9idXR0b24iLCJmbiIsIl9oYW5kbGVTdWJtaXQiLCJhbGwiLCJjYXJkcyIsInVzZXJEYXRhIl0sInNvdXJjZVJvb3QiOiIifQ==